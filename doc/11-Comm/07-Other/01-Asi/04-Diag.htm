<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>Diag</title>
<link href="mnp.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h3>AS-i 通信总线状态诊断</h3>
<h4>1、通过 CM1243-2 指示灯诊断</h4>
<p>CM1243-2 模块面板上有5个 LED 指示灯，用于对模块状态的基本判断，指示灯在模块面板上的位置如图1所示：</p>
<p><img src="images/4-01.jpg" width="353" height="485"></p>
<p>图1. CM1243-2 模块面板指示灯</p>
<p>LED 指示灯具体含义见表1：</p>
<table width="641" border="1">
  <tr>
    <td width="89">指示灯</td>
    <td width="88">颜色</td>
    <td width="442">含义</td>
  </tr>
  <tr>
    <td rowspan="4"><p>DIAG</p></td>
    <td>灭</td>
    <td>无背板总线连接。</td>
  </tr>
  <tr>
    <td>绿闪</td>
    <td>未组态。</td>
  </tr>
  <tr>
    <td>绿</td>
    <td>正常，无错误。</td>
  </tr>
  <tr>
    <td>红闪</td>
    <td><ul>
      <li>AS-i电压丢失；</li>
      <li>内部错误；</li>
      <li>配置错误；</li>
      <li>参数分配错误；</li>
      <li>外部错误；</li>
    </ul>      </td>
  </tr>
  <tr>
    <td rowspan="4">AS-i</td>
    <td>灭</td>
    <td>AS-i 主站离线状态。</td>
  </tr>
  <tr>
    <td>红</td>
    <td>AS-i 总线发生错误。例如 AS-i 总线电压过低。 </td>
  </tr>
  <tr>
    <td>红 闪</td>
    <td>出现错误，并非来自 AS-i 总线。例如 AS-i 从站报告参数错误。 </td>
  </tr>
  <tr>
    <td>绿</td>
    <td>正常，无错误。</td>
  </tr>
  <tr>
    <td>PF</td>
    <td>红</td>
    <td>外部错误。例如输出过载或过载的传感器信号输入。</td>
  </tr>
  <tr>
    <td rowspan="2">CM</td>
    <td>绿</td>
    <td>AS-i 主站处于配置模式。</td>
  </tr>
  <tr>
    <td>灭</td>
    <td>AS-i 主站处于保护模式。</td>
  </tr>
  <tr>
    <td>CER</td>
    <td>黄</td>
    <td><ul>
      <li>在 AS-i 总线上检测不到已配置的从站；</li>
      <li>在 AS-i 总线上检测到未配置的从站；</li>
      <li>在 AS-i 总线上实际的从站和配置的从站参数不匹配；</li>
    </ul>    </td>
  </tr>
</table>
<p>表1. LED 指示灯含义</p>
<p>更多关于 CM1243-5 模块 LED 指示灯的信息，请查看模块手册章节：2.1.1。 </p>
<h4>2、通过“在线和诊断”查看模块信息</h4>
<p>项目在线后，打开“设备视图”，在 CM1243-2 模块上点击鼠标右键，选择”在线和诊断“功能，如图2所示：</p>
<p><img src="images/4-02.jpg" width="470" height="651"></p>
<p>图2. 打开 CM1243-2 的在线和诊断 </p>
<p>在“功能――&gt;控制面板”下，可以查看 CM1243-2 的工作模式，如图3所示： </p>
<p><img src="images/4-03.jpg" width="685" height="345"></p>
<p>图3. CM1243-2 的工作模式</p>
<p>配置总线上 AS-i 从站的操作步骤：</p>
<p>1、组态模式：CPU 处于 stop 模式时才能操作；如果实际的 AS-i 总线上的从站和 CM1243-2 的已有配置不同，则&quot;CER&quot;黄色亮，此时可操作“组态模式”按钮使“CM”绿色亮，进入配置模式；</p>
<p>2、实际―&gt;预设：点击该按钮，读取实际的 AS-i 总线上的从站配置，读取完毕则&quot;CER&quot;指示灯熄灭；</p>
<p>3、受保护的模式：点击该按钮，使 CM1243-2 进入受保护的模式，&quot;CM&quot;指示灯熄灭。</p>
<p>在”诊断――&gt;详细诊断――&gt;错误概览“菜单下，可看到 AS-i 总线上从站的状态，如图4所示：</p>
<p><img src="images/4-04.jpg" width="548" height="576"></p>
<p>图4. 在线诊断 AS-i 从站状态</p>
<h4>3、通过命令读取 AS-i 从站状态列表</h4>
<p>CM1243-2 手册章节7.2.2.4 所描述的命令，可用于从 AS-i 主站读取下列条目：</p>
<p>LAS：激活的 AS-i 从站列表；</p>
<p>LDS：检测到的 AS-i 从站列表；</p>
<p>LPS：已组态的 AS-i 从站列表。</p>
<p>使用指令“RDREC”将索引号 84 发送到 AS-i 主站，即可读取从站的 LAS，LDS，LPS 信息，列表如图5所示：</p>
<p><img src="images/4-05.jpg" width="670" height="507"></p>
<p>图5. 从站的 LAS，LDS，LPS 信息列表</p>
<h4>通过指令编程读取 AS-i 从站状态</h4>
<p>首先，已经通过 TIA Portal 软件正确组态 AS-i 主站和从站；使用指令“RDREC”将索引号 84 发送到 AS-i 主站，即可读取从站的 LAS，LDS，LPS 信息，编程如图6所示：</p>
<p><img src="images/4-06.jpg" width="856" height="359"></p>
<p>图6. 调用 RDREC 指令</p>
<p>然后，选择 AS-i 主站的硬件 ID 号，并填写该指令的相关参数，如图7所示： </p>
<p><img src="images/4-07.jpg" width="547" height="650"></p>
<p>图7. 填写 RDREC 指令相关参数</p>
<p>将程序下载到 CPU 后，通过监控表查看读取到的状态，如图8所示： </p>
<p><img src="images/4-08.jpg" width="618" height="234"></p>
<p>图8. 本例读取的 LAS 信息列表</p>
<p>&nbsp;</p>
<p><img src="images/2.gif" width="15" height="15"> 关于 CM1243-2 模块的更多信息，请查看其手册：</p><p><img src="images/3.gif" alt="" width="15" height="15" /> 按住 Shift 键时用鼠标点击下列链接，打开新浏览器窗口。</p>
<p><a href="http://support.industry.siemens.com/cs/ww/en/view/57358958">http://support.industry.siemens.com/cs/ww/en/view/57358958</a></p>
</body>
</html>
