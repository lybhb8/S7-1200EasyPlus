<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>Intro</title>
<link href="mnp.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h3>S7-1200 串行通信</h3>
<P>S7-1200支持的串行通讯方式</P>
<UL>
  <LI>点对点（PtP）通信    
  <LI>Modbus 主从通信  
  <LI>USS 通信  <br>
  </UL>
<TABLE width="800" border=1>
  <TBODY>
  <TR>
    <TH width="250" scope=col>名称</TH>
    <TH width="350" scope=col>CM 1241 RS232</TH>
    <th width="350" scope="col">CM 1241 RS422/485</th>
    <TH width="350" scope=col>CB 1241 RS485</TH></TR>
  <TR>
    <TH width="250" scope=row>订货号</TH>
    <TD width="350"><div align="center">6ES7241-1AH32-0XB0</div></TD>
    <td width="350"><div align="center">6ES7241-1CH32-0XB0</div></td>
    <TD width="350"><div align="center">6ES7241-1CH30-1XB0</div></TD></TR>
  <TR>
    <TH width="250" scope=row>通讯口类型</TH>
    <TD width="350"><div align="center">RS232</div></TD>
    <td width="350"><div align="center">RS422/RS485</div></td>
    <TD width="350"><div align="center">RS485</div></TD></TR>
  <TR>
    <TH width="250" scope=row>波特率(bps)</TH>
    <TD colSpan=3><div align="center">300 ;600 ;1.2 k; 2.4 k; 4.8 k; 9.6 k;19.2 k; 38.4 k; 
      57.6 k; 76.8 k; 115.2 k</div></TD></TR>
  <TR>
    <TH width="250" scope=row>校验方式</TH>
    <TD colSpan=3>
      <UL>
        <LI>None(无校验) 
        <LI>Even(偶校验) 
        <LI>Odd(奇校验) 
        <LI>Mark(校验位始终置为1) 
        <LI>Space(校验位始终为0) </LI></UL></TD></TR>
  <TR>
    <TH width="250" scope=row>流控</TH>
    <TD width="350"><div align="center">硬件流控；软件流控</div></TD>
    <TD width="350"><div align="center">RS422 支持软件流控</div></TD>
    <TD width="350"><div align="center">不支持</div></TD></TR>
  <TR>
    <TH width="250" scope=row>接收缓冲区</TH>
    <TD colSpan=3><div align="center">1kB</div></TD></TR>
  <TR>
    <TH width="250" scope=row>通讯距离(屏蔽电缆)</TH>
    <TD width="350"><div align="center">10m</div></TD>
    <TD width="350"><div align="center">1000m</div></TD>
    <TD width="350"><div align="center">1000m</div></TD></TR>
  <tr>
    <th scope="row">电源消耗(5V DC)</th>
    <td><div align="center">200mA</div></td>
    <td><div align="center">220mA</div></td>
    <td><div align="center">50mA</div></td>
  </tr>
  <tr>
    <th scope="row">电源消耗(24V DC)</th>
    <td><div align="center">-</div></td>
    <td><div align="center">-</div></td>
    <td><div align="center">80mA</div></td>
  </tr>
  </TBODY></TABLE>
<h4>S7-1200 串口通信模块的特征</h4>
<p><img src="images/1-01.jpg" width="435" height="339" /></p>
<p>图1. CM1241串口通信模块</p>
<p><img src="images/1-02.jpg" width="234" height="400" /></p>
<p>图2. CB1241串口通信模块</p>
<ol><li>由 CPU 供电，不必连接外部电源<br>
    <br>
  </li>
  <li>端口经过隔离，最长距离1000 米<br>
    <br>
  </li>
  <li>有诊断 LED 及显示传送和接收活动 LED<br>
    <br>
  </li>
  <li>支持点对点协议<br>
    <br>
  </li>
  <li>通过扩展指令和库功能进行组态和编程</li>
</ol>
<h4>RS485 与 RS232 通信模块的LED</h4>
<p><strong>诊断 LED 灯</strong></p>
<ul>
  <li><strong>红闪：</strong>如果 CPU 未正确识别到通信模块，诊断 LED 会一直红色闪烁 </li>
  <li><strong>绿闪：</strong>CPU 上电后已经识别到通信模块，但是通信模块还没有配置</li>
  <li><strong>绿灯：</strong>CPU 已经识别到通信模块，且配置也已经下载到了CPU</li>
</ul>
<p><strong>发送 LED 灯</strong></p>
<ul>
  <li>代表数据正在通过通信口传送出去</li>
</ul>
<p><strong>接收 LED 灯</strong></p>
<ul>
  <li>代表数据正在通过通信口接收进来</li>
</ul>
<p><img src="images/3.gif" width="15" height="15"><strong>注意：</strong>通信板 CB1241 只有发送和接收 LED 灯，而没有诊断 LED 灯</p>
<h4>串口模板支持的协议</h4>
<ul>
  <li>ASCII</li>
  <li>USS</li>
  <li>Modbus RTU 主站</li>
  <li>    Modbus RTU 从站</li>
  <li>3964R（RS232/RS422支持）<br>
  </li>
</ul>
<h4>ASCII 协议的特点</h4>
<ul>
  <li>报文可以由用户自己定义，便于用户以 ASCII 协议为基础开发</li>
  <li>使用简单，可以很好地实现与第三方系统的通讯 </li>
  <li>可以进行识别报文结束设置</li>
  <li>可以进行数据流量控制</li>
  <li>缺点：具有简单的校验功能（奇偶校验），低数据安全性；数据传输无确认信息； 通讯需要双方协调</li>
</ul>
<h4>S7-1200 的 PTP 校验</h4>
<p><strong>串口的校验：</strong> 奇偶校验：用于检验数据传递的正确性，是最简单的检错方法。</p>
<p><img src="images/1-03.JPG" width="536" height="145" /><br>
  <br>
图3. 校验设置</p>
<ul>
  <li><strong>偶校验：</strong>如果每字节的数据位中“1”的个数为奇数，则校验位为1，如果个数为偶数，则校验位为“0”，                                   保证数据位和校验位中“1”的个数是偶数</li>
  <li><strong>奇校验：</strong>如果每字节的数据位中“1”的个数为奇数，则校验位为0，如果个数为偶数，则校验位为“1”，                  保证数据位和校验位中“1”的个数是奇数</li>
  <li><strong>传号校验：</strong>奇偶校验位始终设置为 1</li>
  <li><strong>空号校验：</strong>奇偶校验位始终设置为 0</li>
</ul>
<p><strong><img src="images/3.gif" width="15" height="15">注意：</strong>奇偶校验可以简单的判断数据的正确性，从原理上可看出当一位出错，可以准确判断，当两位或更多位误码就校验不出，但由于其实现简单，仍得到了广泛使用。</p>
<h4>PTP 通信的发送信息配置</h4>
<p>定义在信息起始发送断点及空闲线</p>
<p><strong>字符中断</strong>：当接收到的数据保持为零值的时间大于完整的字符传输时间时，代表字符中断。一个完整字符传输时间定义为传输起始位、数据位、校验位和停止位的时间总和。</p>
<p><img src="images/1-04.JPG" width="801" height="541" /></p>
<p>图4. 定义在信息起始发送断点及空闲线</p>
<p><strong><img src="images/5.gif" width="15" height="15">常问问题：</strong>为什么发送配置中只配了2位字符中断，而通信伙伴却可以正常接收数据？<br>
<strong>答：</strong>发送配置中设置的字符中断小于等于16位时，系统自动发出16位的字符中断位；设置大于16位时，则发出的中断位与实际设置相符。下图是设置的发送断点及空闲线位及其实际发出的波形图。</p>
<table width="641" border="0">
  <tr>
    <td width="354"><div align="center"><strong>波形图</strong></div></td>
    <td width="271" bordercolor="#FFFFFF"> <div align="center"><strong>断点及空闲线设置</strong></div></td>
  </tr>
</table>
<p align="left"><img src="images/1-05.jpg" width="637" height="363" /></p>
<p align="left">图5. 断点及空闲线波形图</p>
<h4>PTP 通信接收起始条件</h4>
<p><strong>以任意字符开始</strong></p>
<p><strong>以特殊条件开始</strong>：</p>
<ul>
  <li>通过断点识别消息开始</li>
  <li>通过空闲线识别消息开始</li>
  <li>通过单个字符识别消息开始</li>
  <li>通过字符序列识别消息开始</li>
</ul>
<p><img src="images/1-06.JPG" width="442" height="308" /></p>
<p>图6. 通信接收起始条件</p>
<p><strong>通过字符序列识别消息开始</strong></p>
<p>对于多个起始序列的组态，只要出现其中一个序列，即会满足开始条件。下图右侧即为满足起始条件的字符串。</p>
<p><img src="images/1-07.JPG" width="628" height="538" /></p>
<p>图7. 通过字符序列识别消息开始</p>
<p><strong>如果选择了多个起始条件，则检查开始条件的顺序如下: </strong></p>
<p><img src="images/1-08.jpg" width="216" height="323" /></p>
<p><strong><img src="images/3.gif" width="15" height="15">注意:</strong></p>
<p>检查多个开始条件时，如果有一个条件没有满足，则 CM 将从第一个所需的条件开始重新启动检查。</p>
<p>        如果同时组态了字符和字符序列作为开始条件，则字符序列的判断条件无效。<br />
</p>
<h4>PTP 通信接收结束条件</h4>
<ul>
  <li>通过消息超时识别：时间从接到符合消息开始条件的第一个字符时开始计算</li>
  <li>通过响应超时识别：时间从传送结束时开始计算，在指定时间内接收到字符，需要和其他结束条件配合使用</li>
  <li>通过字符间隙识别：消息中两个连续字符间的间隔超时后，视为消息结束</li>
  <li>通过最大长度识别：在接收到组态的最大字符数后，视为消息结束</li>
  <li>通过固定长度识别：在接收到组态的最大字符后，视为消息结束</li>
  <li>消息本身指定消息长度，在接收到指定长度的消息后，视为消息结束</li>
  <li>在接收到指定的字符序列后，视为消息结束</li>
</ul>
<p><img src="images/1-09.JPG" width="425" height="466" /></p>
<p>图8.结束条件设置</p>
<p><strong><img src="images/3.gif" width="15" height="15">注意:</strong>与多个起始条件的判断不同，检查多个结束条件时，任何一个条件满足，信息接收结束。</p>
<p><strong>消息超时结束条件<br>
</strong><strong><br>
</strong>消息超时时间从接到符合消息开始条件的第一个字符时开始计算，如下图。</p>
<p><img src="images/1-10.jpg" width="374" height="233" /></p>
<p>图9.消息超时</p>
<p><strong>响应超时结束条件</strong></p>
<p>响应超时时间从传送结束时开始计算，只要传送成功完成且模块开始接收操作，定时器就会启动。</p>
<p><img src="images/1-11.jpg" width="375" height="231" /></p>
<p>图10.响应超时</p>
<p><strong><img src="images/3.gif" width="15" height="15">注意:</strong>响应超时结束条件不能作为单独的结束条件的设置，否则会在编译时报如下错误:</p>
<p><img src="images/1-12.png" width="777" height="310" /></p>
<p>图11.响应超时作为单独的结束条件报错</p>
<p><strong>从消息中读取信息长度</strong></p>
<p><img src="images/1-13.JPG" width="824" height="577" /></p>
<p>图12.从消息中读取信息长度的设置</p>
<p>实际收到的数据长度=长度偏移前的字节数+长度字节大小+读取的实际数据长度+不计入字节长度的字节数 10=（2-1）+1+2+6</p>
<h4>PTP 通信接收缓存区</h4>
<p><img src="images/1-14.JPG" width="425" height="156" /></p>
<p>图13.接收缓冲区设置</p>
<p><strong><img src="images/3.gif" alt="" width="15" height="15" />注意:</strong>缓存区可以存储多条信息，限制是20条信息或最多1024字节。</p>
<p><strong>缓存区的数据保持</strong></p>
<p>断电后缓存区中的数据全部丢失,不能保持。</p>
<p>勾选&ldquo;在启动时清空接收缓冲区&rdquo;，CPU停止再启动时，缓冲区数据清空。</p>
<p><strong>通信模板缓存区超出20条信息</strong></p>
<p>启用了&ldquo;防止重写&rdquo;，如果缓存区中的信息超过20条，后面的信息被   自动丢弃，报错16#81E6。</p>
<p>不启用&ldquo;防止重写&rdquo;，如果缓存区中的信息超过20条，后面的信息会将之前的信息覆盖，且不报错。</p>
<p><strong>通信模板缓存区多包数据超出1024字节</strong></p>
<p>发送多个每包50个字节数据，当数据超过1024字节那包就被丢弃了，前面的可以正常接收，且没有任何报错.在前面数据被成功接收以后，只要缓存区有空间，后面的数据还可以正常收到。</p>
<p><strong>通信模板缓存区一包数据超出1024字节</strong></p>
<p>如果发送数据一包就大于1024字节时，缓冲区接收到数据到1024字节时，虽然没有收到结束字符，数据由缓存区送给CPU，但会报错16#80E0,如下图。</p>
<p><img src="images/1-15.JPG" width="433" height="254" /></p>
<p>图14. 发送数据一包大于1024字节时,缓存区报错</p>
<p><strong><a name="RESET" id="RESET"></a>通信模板缓存区复位</strong></p>
<p>当缓冲区溢出报错时，需要使用Reset指令进行清除缓冲区的操作。</p>
<p><img src="images/1-16.JPG" width="432" height="187" /></p>
<p>图15. 使用Reset指令复位缓存区错误，恢复数据接收</p>
<h4>为什么不能使用 PC/PPI	电缆与S7-1200 RS485 模块进行串口调试？ </h4>
<p><strong>答：</strong>因为 S7-1200 RS485 模块接口不提供24V电源，不能给 PC/PPI	电缆供电，所以电缆无法工作。</p>
<p><strong>解决办法：</strong>可以将 S7-1200 RS485 与 S7-200 通信口网络连接，将 PC/PPI	电缆插在 S7-200 通信口上总线连接器的编程口上，对S7-1200 RS485进行串口调试。此时S7-200必须上电并打到停止状态。 <strong><br>
</strong></p>
</BODY>
</HTML>
连接</td>
   </tr>
   <tr>
     <td>5</td>
     <td>GND</td>
     <td>逻辑地或通信地</td>
     <td>金属壳</td>
     <td>-</td>
     <td>外壳接地</td>
   </tr>
 </table>
 </body>
</html>
